@page "/ForgotPassword"
@layout EmptyLayout
@using AdvancedAnalysisDesign.Models.Database
@using AdvancedAnalysisDesign.Models
@using AdvancedAnalysisDesign.Enums

<MudMainContent>
    <MudContainer MaxWidth="MaxWidth.Small" Class="mt-16">
        <MudGrid Justify="Justify.Center" Class="mt-16">
            <MudItem>
                 <EditForm Model="@ForgotModel">
                    <MudCard Elevation="5" Class="ForgotPasswordCard">
                        <MudCardContent>
                            <MudGrid Justify="Justify.Center">
                                <MudItem>
                                    <MudText Align="Align.Center" Typo="Typo.h3">Forgot Password</MudText> @*Title for page*@
                                </MudItem>
                                @if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.EmailRequest)
                                {
                                    <MudItem>
                                        <MudText Style="text-align: center;" Typo="Typo.body2">Recover your Binary Beast account. Type in your Email and click Next.</MudText>
                                        <MudTextField Label="Email" @bind-Value="ForgotModel.EmailAddress" For="@(() => ForgotModel.EmailAddress)"/> @*Text field for user to type in their email.*@
                                    </MudItem>
                                }
                                else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.TokenRequest)
                                {
                                    <MudItem>
                                        <MudText Style="text-align: center;" Typo="Typo.body2">Type in the 6 digit code sent to your email and click Reset Password. Do not refresh.</MudText>
                                        <MudTextField Label="Code" @bind-Value="ForgotModel.Token" For="@(() => ForgotModel.Token)"/> @*Text field for user to type in their email.*@
                                    </MudItem>
                                }
                                else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.ResetPasswordRequest)
                                {
                                    <MudItem>
                                        <MudText Style="text-align: center;" Typo="Typo.body2">Type in your new password and click Reset Password. Do not refresh.</MudText>
                                        <MudTextField Label="New Password" @bind-Value="ForgotModel.Password" For="@(() => ForgotModel.Password)"/> @*Text field for user to type in their email.*@
                                        <MudTextField Label="Repeat New Password" @bind-Value="ForgotModel.PasswordComparison" For="@(() => ForgotModel.PasswordComparison)"/> @*Text field for user to type in their email.*@
                                    </MudItem>
                                }
                            </MudGrid>
                        </MudCardContent>
                        <MudCardActions>
                            <MudGrid Justify="Justify.Center" Style="flex-direction: column; align-items: center; justify-content: center">
                                @if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.EmailRequest)
                                {
                                    <MudItem xs="12">
                                        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Style="min-width:23rem" OnClick="@SendTokenRequest">Next</MudButton>
                                    </MudItem>
                                }
                                else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.TokenRequest)
                                {
                                    <MudItem xs="12">
                                        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Style="min-width:23rem" OnClick="@EnterTokenRequest">Reset Password</MudButton>
                                    </MudItem>
                                }
                                else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.ResetPasswordRequest)
                                {
                                    <MudItem xs="12">
                                        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Style="min-width:23rem" OnClick="@ForgotPasswordRequest">Reset Password</MudButton>
                                    </MudItem>
                                }
                                <MudItem xs="12" Class="mt-n3">
                                    <MudLink Href="/Login" Typo="Typo.body2">Back to Login</MudLink> @*Link to Login page*@
                                </MudItem>
                            </MudGrid>
                        </MudCardActions>
                    </MudCard>
                </EditForm>
            </MudItem>
        </MudGrid>
    </MudContainer>
</MudMainContent>

@code {
    User UserModel = new User();
    ForgotPasswordPayload ForgotModel = new ForgotPasswordPayload();

    public void SendTokenRequest()
    {
        ForgotModel.ForgotPasswordStage = ForgotPasswordStage.EmailRequest;
        //TODO

            // check that user email is in DB.

            // if true send token to email.

            // if not true send them to token page without a token (best practice as to not farm user emails in DB).

    }
    public void EnterTokenRequest()
    {
        ForgotModel.ForgotPasswordStage = ForgotPasswordStage.TokenRequest;
        //TODO
    }
    public void ForgotPasswordRequest()
    {
        //TODO
    }

}