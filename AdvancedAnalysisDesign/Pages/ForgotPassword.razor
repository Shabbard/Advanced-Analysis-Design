@page "/ForgotPassword"
@layout EmptyLayout
@using AdvancedAnalysisDesign.Models.Database
@using AdvancedAnalysisDesign.Models
@using AdvancedAnalysisDesign.Enums


<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-16">



        <EditForm Model="@ForgotModel" class="max-width-26rem center mt-30">
            <MudCard Elevation="5" Class="ForgotPasswordCard" Style="width:26rem">
                <div class="p-3">
                    @*Added divs throughout to padd and margin the fields.*@


                    <MudCardContent>
                        <MudText Style="text-align:center; font-weight:bold" Typo="Typo.h4">Forgot Password</MudText>   @*Title for page*@

                        @if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.EmailRequest)
                        {
                            <div class="mt-2">
                                <MudText Style="text-align: center;" Typo="Typo.body2">Recover your Binary Beast account. Type in your Email and click Next.</MudText>
                            </div>
                            <div class="mt-4">
                                <MudTextField Label="Email" @bind-Value="ForgotModel.EmailAddress" For="@(() => ForgotModel.EmailAddress)" />   @*Text field for user to type in their email.*@
                            </div>
                        }
                        else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.TokenRequest)
                        {
                            <div class="mt-2">
                                <MudText Style="text-align: center;" Typo="Typo.body2">Type in the 6 digit code sent to your email and click Reset Password. Do not refresh.</MudText>
                            </div>
                            <div class="mt-4">
                                <MudTextField Label="Code" @bind-Value="ForgotModel.Token" For="@(() => ForgotModel.Token)" />   @*Text field for user to type in their email.*@
                            </div>
                        }
                        else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.ResetPasswordRequest)
                        {
                            <div class="mt-2">
                                <MudText Style="text-align: center;" Typo="Typo.body2">Type in your new password and click Reset Password. Do not refresh.</MudText>
                            </div>
                            <div class="mt-4">
                                <MudTextField Label="New Password" @bind-Value="ForgotModel.Password" For="@(() => ForgotModel.Password)" />   @*Text field for user to type in their email.*@
                            </div>
                            <div class="mt-4">
                                <MudTextField Label="Repeat New Password" @bind-Value="ForgotModel.PasswordComparison" For="@(() => ForgotModel.PasswordComparison)" />   @*Text field for user to type in their email.*@
                            </div>
                        }

                    </MudCardContent>
                    <MudCardActions>
                        @if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.EmailRequest)
                        {
                            <div class="mt-4">
                                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Style="min-width:23rem" OnClick="@SendTokenRequest">Next</MudButton>
                            </div>
                        }
                        else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.TokenRequest)
                        {
                            <div class="mt-4">
                                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Style="min-width:23rem" OnClick="@EnterTokenRequest">Reset Password</MudButton>
                            </div>
                        }
                        else if (ForgotModel.ForgotPasswordStage == ForgotPasswordStage.ResetPasswordRequest)
                        {
                            <div class="mt-4">
                                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Style="min-width:23rem" OnClick="@ForgotPasswordRequest">Reset Password</MudButton>
                            </div>
                        }
                    </MudCardActions>

                    <div style="text-align:center">
                        @*centered text in div as MudLink text center property does not work*@
                        <MudLink Href="/Login" Style="padding-bottom:0.5rem" Typo="Typo.body2">Back to Login</MudLink> @*Link to Login page*@
                    </div>
                </div>
            </MudCard>
        </EditForm>




</MudContainer>

@code {
    User UserModel = new User();
    ForgotPasswordPayload ForgotModel = new ForgotPasswordPayload();

    public void SendTokenRequest()
    {
        ForgotModel.ForgotPasswordStage = ForgotPasswordStage.EmailRequest;
        //TODO

            // check that user email is in DB.

            // if true send token to email.

            // if not true send them to token page without a token (best practice as to not farm user emails in DB).

    }
    public void EnterTokenRequest()
    {
        ForgotModel.ForgotPasswordStage = ForgotPasswordStage.TokenRequest;
        //TODO
    }
    public void ForgotPasswordRequest()
    {
        //TODO
    }

}