@page "/PatientView"
@using AdvancedAnalysisDesign.Models.Database
@using AdvancedAnalysisDesign.Services
@using InputType = MudBlazor.InputType

@using AdvancedAnalysisDesign.Enums
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

@inject UserService UserService
@inject ISnackbar Snackbar
@inject NavigationManager NavManager
@*Limit to user + admin*@
@*Link to specific user*@

<AuthorizeView>
    <MudContainer>
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Align="Align.Center" Typo="Typo.h3">Patient Information</MudText>
            </CardHeaderContent>
        </MudCardHeader>
        <MudExpansionPanels MultiExpansion="true">
            <MudExpansionPanel Text="Medication">
                <MudContainer MaxWidth="MaxWidth.Medium" Class="mt-16">
                    <MudCard Elevation="5" Class="MedicationCard">

                        @* Data table for Medication *@
                        <MudTable Height="400px" Items="medicationTableData" Hover="@hover" Breakpoint="Breakpoint.Sm">
                            <HeaderContent>
                                <MudTh>Name</MudTh>
                                <MudTh>Bloodwork Required</MudTh>
                            </HeaderContent>

                            <RowTemplate Context="row">
                                <MudTd DataLabel="Name">@row.Medication.Name</MudTd>
                                <MudTd DataLabel="Expiry">@row.Medication.BloodworkRequired</MudTd>
                            </RowTemplate>

                            <PagerContent>
                                <MudTablePager />
                            </PagerContent>
                        </MudTable>

                    </MudCard>

                    @*Add Request Medication Button*@


                </MudContainer>
            </MudExpansionPanel>
            <MudExpansionPanel Text="Bloodwork">
                <MudContainer MaxWidth="MaxWidth.Medium" Class="mt-16">
                    <MudCard Elevation="5" Class="MedicationCard">

                        @* Data table for Bloodwork *@
                        <MudTable Height="400px" Items="bloodworkTableData" Hover="@hover" Breakpoint="Breakpoint.Sm">
                            <HeaderContent>
                                <MudTh>Id</MudTh>
                                <MudTh>Date</MudTh>
                            </HeaderContent>

                            <RowTemplate Context="row">
                                <MudTd DataLabel="Id">@row.Id</MudTd>
                                <MudTd DataLabel="Date">@row.DateOfResults</MudTd>
                            </RowTemplate>

                            <PagerContent>
                                <MudTablePager />
                            </PagerContent>
                        </MudTable>

                    </MudCard>

                </MudContainer>
            </MudExpansionPanel>
        </MudExpansionPanels>
    </MudContainer>
</AuthorizeView>

@code{
    private bool hover = true;

    private List<PatientMedication> medicationTableData = new List<PatientMedication>();
    private List<PatientBloodwork> bloodworkTableData = new List<PatientBloodwork>();


    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.IsInRole(Role.Patient.ToString()) || user.IsInRole(Role.Admin.ToString()))
        {
        }
        else
        {
            NavigationManager.NavigateTo("/", true);
        }
    }
}