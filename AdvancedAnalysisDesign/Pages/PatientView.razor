@page "/PatientView"
@using AdvancedAnalysisDesign.Models.Database
@using AdvancedAnalysisDesign.Services
@using InputType = MudBlazor.InputType

@using AdvancedAnalysisDesign.Enums
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

@inject UserService UserService
@inject ISnackbar Snackbar
@inject NavigationManager NavManager

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-16">
    <MudGrid  Justify="Justify.Center">
        <MudItem xs="6">
            <MudPaper Elevation="5">

                @* Data table for Medication *@
                <MudTable Height="700px" FixedHeader="true" Items="medicationTableData"  Hover="@hover" Breakpoint="Breakpoint.Sm">

                    <ToolBarContent>
                        <MudText Typo="Typo.h6">Medication</MudText>
                    </ToolBarContent>

                    <HeaderContent>
                        <MudTh>Name</MudTh>
                        <MudTh>Bloodwork Required</MudTh>
                    </HeaderContent>

                    <RowTemplate Context="row">
                        <MudTd DataLabel="Name">@row.Medication.Name</MudTd>
                        <MudTd DataLabel="Expiry">@row.Medication.BloodworkRequired</MudTd>
                    </RowTemplate>

                    @*<PagerContent>
                        <MudTablePager />
                    </PagerContent>*@
                </MudTable>

            </MudPaper>
        </MudItem>

        <MudItem xs="6">
            <MudPaper Elevation="5">

                @* Data table for Bloodwork *@
                <MudTable Height="700px" FixedHeader="true" Items="bloodworkTableData" Hover="@hover" Breakpoint="Breakpoint.Sm">
                    <ToolBarContent>
                        <MudText Typo="Typo.h6">Bloodwork</MudText>
                    </ToolBarContent>

                    <HeaderContent>
                        <MudTh>Id</MudTh>
                        <MudTh>Date</MudTh>
                    </HeaderContent>

                    <RowTemplate Context="row">
                        <MudTd DataLabel="Id">@row.Id</MudTd>
                        <MudTd DataLabel="Date">@row.DateOfResults</MudTd>
                    </RowTemplate>

                    @*<PagerContent>
                <MudTablePager />
            </PagerContent>*@
                </MudTable>

            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>

@code{
    private bool hover = true;

    private List<PatientMedication> medicationTableData = new List<PatientMedication>();
    private List<PatientBloodwork> bloodworkTableData = new List<PatientBloodwork>();

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.IsInRole(Role.Patient.ToString()) || user.IsInRole(Role.Admin.ToString()))
        {
        }
        else
        {
            NavigationManager.NavigateTo("/", true);
        }
    }
}